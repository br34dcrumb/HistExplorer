<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HistExplorer — SQLite Viewer</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        ideBg: '#1e1e1e',
                        ideSidebar: '#252526',
                        ideBorder: '#3c3c3c',
                        ideHeader: '#2d2d2d',
                        ideSelect: '#37373d',
                        ideHighlight: '#2a2d2e',
                        ideText: '#cccccc',
                        idePurple: '#c678dd',
                        ideYellow: '#e5c07b',
                        ideBlue: '#61afef',
                        ideRed: '#e06c75',
                        ideGreen: '#98c379',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="styles.css">

    <!-- sql.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <!-- Lucide Icons -->
    <!-- CodeMirror 5: SQL syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/sql/sql.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-ideBg text-ideText h-screen flex flex-col overflow-hidden selection:bg-ideSelect selection:text-white">

    <!-- ═══ TOP MENU BAR ═══ -->
    <header
        class="h-[30px] w-full bg-ideSidebar border-b border-ideBorder flex items-center px-2 text-[13px] shrink-0 gap-1">
        <div class="flex items-center gap-1 hover:bg-ideSelect px-2 py-1 cursor-pointer" id="open-file-btn"
            title="Open SQLite file" data-shortcut-mod="MOD+O">
            <i data-lucide="folder" class="w-4 h-4 text-ideYellow fill-ideYellow"></i>
            <span>Open File</span>
        </div>
        <div class="h-4 w-px bg-ideBorder mx-1"></div>
        <!-- Breadcrumb -->
        <div class="flex items-center gap-1.5 text-ideText min-w-0 flex-1 overflow-hidden" id="breadcrumb">
            <span class="text-ideText/40 italic text-[12px]">No file loaded...</span>
        </div>
        <!-- right controls -->
        <div class="ml-auto flex items-center gap-3 shrink-0">
            <i data-lucide="shield" class="w-3 h-3 text-emerald-500"
                title="Data processed locally — nothing is sent to any server"></i>
            <span id="error-msg" class="text-ideRed text-[12px] hidden"></span>
        </div>
        <input type="file" id="file-input" class="hidden" />
    </header>

    <!-- ═══ MAIN WORKSPACE ═══ -->
    <div class="flex flex-1 overflow-hidden">

        <!-- ── SIDEBAR ── -->
        <aside class="w-[210px] bg-ideSidebar border-r border-ideBorder flex flex-col shrink-0 text-[13px]">
            <!-- Search -->
            <div class="px-2 py-[5px] border-b border-ideBorder">
                <input type="text" id="schema-search" placeholder="Search schema..."
                    class="w-full bg-transparent border border-ideBorder text-ideText text-[12px] px-2 py-[2px] focus:outline-none focus:border-ideBlue placeholder:text-ideText/30">
            </div>

            <!-- Schema Tree -->
            <div class="flex-1 overflow-y-auto" id="schema-tree">
                <!-- empty state -->
                <div class="px-4 py-3 text-[12px] text-ideText/40 italic" id="schema-empty">No database loaded</div>
            </div>
        </aside>

        <!-- ── MAIN CONTENT ── -->
        <main class="flex-1 flex flex-col bg-ideBg min-w-0 overflow-hidden">

            <!-- ── TOOLBAR ── -->
            <div
                class="h-[35px] border-b border-ideBorder flex items-center px-2 shrink-0 bg-ideHeader gap-2 text-[13px]">
                <!-- Search -->
                <div class="flex items-center gap-1 border border-ideBorder bg-ideBg px-2">
                    <i data-lucide="search" class="w-3 h-3 text-ideText/40 shrink-0"></i>
                    <input type="text" id="search-input" placeholder="Search in table..."
                        class="w-[180px] bg-transparent text-ideText text-[12px] py-[2px] focus:outline-none disabled:opacity-30 placeholder:text-ideText/30"
                        disabled>
                </div>

                <!-- Reset -->
                <button id="reset-btn"
                    class="px-2 py-[3px] border border-ideBorder hover:bg-ideSelect text-ideText/60 hover:text-ideText flex items-center gap-1 disabled:opacity-30"
                    disabled>
                    <i data-lucide="rotate-ccw" class="w-3 h-3"></i> Reset
                </button>

                <!-- Export -->
                <button id="export-csv-btn"
                    class="px-2 py-[3px] border border-ideBorder hover:bg-ideSelect text-ideText/60 hover:text-ideText flex items-center gap-1 disabled:opacity-30"
                    disabled>
                    <i data-lucide="download" class="w-3 h-3"></i> Export CSV
                </button>

                <!-- Stats -->
                <span class="text-ideText/50 text-[12px] ml-1" id="record-stats">Records: 0</span>

                <!-- SQL Editor toggle -->
                <div class="ml-auto flex items-center gap-2">
                    <button id="run-sql-btn"
                        class="px-2 py-[3px] border border-ideBlue/50 text-ideBlue hover:bg-ideBlue/10 flex items-center gap-1 text-[12px] disabled:opacity-30"
                        disabled>
                        <i data-lucide="play" class="w-3 h-3"></i> Run SQL
                    </button>
                    <button id="toggle-sql-btn"
                        class="px-2 py-[3px] border border-ideBorder hover:bg-ideSelect text-ideText/60 hover:text-ideText flex items-center gap-1 text-[12px]"
                        title="Toggle SQL Editor">
                        <i data-lucide="terminal" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>

            <!-- ── LANDING VIEW ── -->
            <div id="view-landing"
                class="view-active flex-1 flex flex-col items-center justify-center p-8 bg-ideBg text-center">
                <i data-lucide="database" class="w-16 h-16 text-ideBorder mb-4"></i>
                <h2 class="text-xl text-ideText mb-2">HistExplorer</h2>
                <p class="text-[13px] text-ideText/50 max-w-sm mb-6">Open any SQLite database file to browse tables, run
                    queries, and export data. Everything runs locally.</p>

                <div
                    class="text-left bg-ideSidebar p-4 border border-ideBorder text-[12px] w-full max-w-2xl font-mono text-ideText/70">
                    <div class="mb-2 text-idePurple font-bold"># Common file locations</div>
                    <div class="grid grid-cols-[110px_1fr] gap-x-3 gap-y-1">
                        <span class="text-ideYellow">Chrome (Win)</span><span>%LocalAppData%\Google\Chrome\User
                            Data\Default\History</span>
                        <span class="text-ideYellow">Chrome (Mac)</span><span>~/Library/Application
                            Support/Google/Chrome/Default/History</span>
                        <span class="text-ideYellow">Edge (Win)</span><span>%LocalAppData%\Microsoft\Edge\User
                            Data\Default\History</span>
                        <span class="text-ideBlue mt-1">Firefox (Win)</span><span
                            class="mt-1">%AppData%\Mozilla\Firefox\Profiles\&lt;id&gt;\places.sqlite</span>
                        <span class="text-ideBlue">Safari (Mac)</span><span>~/Library/Safari/History.db</span>
                    </div>
                </div>
            </div>

            <!-- ── DATA VIEW ── -->
            <div id="view-data" class="view-hidden flex-1 flex flex-col overflow-hidden relative">

                <!-- Loading overlay -->
                <div id="table-loading"
                    class="hidden absolute inset-0 bg-ideBg/80 z-50 flex items-center justify-center">
                    <div class="flex items-center gap-2 text-ideText text-[13px]">
                        <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Executing...
                    </div>
                </div>

                <!-- Data grid -->
                <div class="flex-1 overflow-auto data-grid-container min-h-0" id="data-grid-wrapper">
                    <table id="data-table"
                        class="min-w-full text-left border-collapse border border-ideBorder text-[12px] table-fixed">
                        <thead id="data-thead" class="bg-ideHeader sticky top-0 z-40 border-b-2 border-ideBorder">
                            <!-- dynamic headers injected here -->
                        </thead>
                        <tbody id="data-tbody" class="font-mono text-[12px]">
                            <!-- dynamic rows injected here -->
                        </tbody>
                    </table>
                </div>

                <!-- Cell detail panel -->
                <div id="cell-detail-panel" class="hidden border-t border-ideBorder bg-ideSidebar shrink-0">
                    <div
                        class="flex items-center justify-between px-3 py-1 border-b border-ideBorder text-[11px] text-ideText/50">
                        <span>Cell Value — <span id="cell-detail-label" class="text-ideText/70"></span></span>
                        <button id="close-detail-btn" class="hover:text-ideText"><i data-lucide="x"
                                class="w-3 h-3"></i></button>
                    </div>
                    <pre id="cell-detail-content"
                        class="px-3 py-2 text-[12px] text-ideText font-mono overflow-auto max-h-[120px] whitespace-pre-wrap break-all"></pre>
                </div>

                <!-- SQL editor panel -->
                <div id="sql-editor-panel" class="hidden border-t border-ideBorder bg-ideSidebar shrink-0"
                    style="height: 130px; display: none; flex-direction: column;">
                    <!-- Drag-resize handle -->
                    <div id="sql-resize-handle" class="sql-resize-handle" title="Drag to resize"></div>
                    <div
                        class="flex items-center justify-between px-3 py-1 border-b border-ideBorder text-[11px] text-ideText/50 shrink-0">
                        <span class="text-ideBlue font-mono">SQL Editor</span>
                        <div class="flex items-center gap-1">
                            <span class="text-ideText/30 mr-1">Presets:</span>
                            <button class="sql-preset-btn" data-preset="chrome" title="Chromium history query">
                                <i data-lucide="chrome" class="w-3 h-3"></i> Chrome / Edge
                            </button>
                            <button class="sql-preset-btn" data-preset="firefox" title="Firefox history query">
                                <i data-lucide="flame" class="w-3 h-3"></i> Firefox
                            </button>
                            <button class="sql-preset-btn" data-preset="safari" title="Safari history query">
                                <i data-lucide="compass" class="w-3 h-3"></i> Safari
                            </button>
                            <span class="w-px h-3 bg-ideBorder mx-1"></span>
                            <button class="sql-preset-btn" data-preset="top_visited" title="Top visited URLs">
                                <i data-lucide="bar-chart-2" class="w-3 h-3"></i> Top Visited
                            </button>
                            <button class="sql-preset-btn" data-preset="by_domain" title="Group by domain">
                                <i data-lucide="globe" class="w-3 h-3"></i> By Domain
                            </button>
                            <button class="sql-preset-btn" data-preset="recent_week" title="Last 7 days">
                                <i data-lucide="calendar" class="w-3 h-3"></i> Last 7 Days
                            </button>
                            <span class="w-px h-3 bg-ideBorder mx-1"></span>
                            <span class="text-ideText/30"
                                data-shortcut-mod="MOD+Enter to run &nbsp;·&nbsp; MOD+` to toggle">Ctrl+Enter to run
                                &nbsp;·&nbsp; Ctrl+` to toggle</span>
                        </div>
                    </div>
                    <textarea id="sql-editor"
                        class="sql-editor flex-1 w-full bg-ideBg text-ideText font-mono text-[12px] px-3 py-2 resize-none focus:outline-none border-none min-h-0"
                        placeholder="SELECT * FROM table_name LIMIT 100;"></textarea>
                </div>

                <!-- Status footer -->
                <div
                    class="h-[25px] border-t border-ideBorder flex items-center px-3 shrink-0 bg-ideSidebar text-[12px] gap-3">
                    <span class="text-ideText/50" id="row-display-info">No data</span>
                    <span class="ml-auto flex items-center gap-1.5" id="db-type-badge">
                        <i data-lucide="database" class="w-3 h-3 text-ideText/30"></i>
                        <span class="text-ideText/40">No DB loaded</span>
                    </span>
                </div>
            </div>

        </main>
    </div>

    <script src="app.js"></script>
    <script>lucide.createIcons();</script>
</body>

</html>